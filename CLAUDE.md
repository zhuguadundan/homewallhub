# CLAUDE.md

è¿™ä¸ªæ–‡ä»¶ä¸º Claude Code (claude.ai/code) åœ¨æ­¤ä»£ç åº“ä¸­å·¥ä½œæ—¶æä¾›æŒ‡å¯¼ã€‚

## ğŸ—ï¸ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯"å®¶å’Œæ™ºèƒ½åŠ©æ‰‹"é¡¹ç›®ï¼Œä¸€ä¸ªåŸºäº Koa.js + Vue 3 + TypeScript æ„å»ºçš„æ™ºèƒ½å®¶åº­ç®¡ç†åº”ç”¨ã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ä»»åŠ¡ç®¡ç†ã€åº“å­˜ç®¡ç†ã€ç‚¹èœç³»ç»Ÿã€å…±äº«æ—¥å†ã€å®¶åº­ç•™è¨€æ¿ç­‰ã€‚

## ğŸ”§ å¼€å‘ç¯å¢ƒå’Œå¸¸ç”¨å‘½ä»¤

### é¡¹ç›®ç»“æ„
```
jiehe-smart-assistant/
â”œâ”€â”€ backend/          # åç«¯ Koa.js åº”ç”¨
â”œâ”€â”€ frontend/         # å‰ç«¯ Vue 3 åº”ç”¨
â”œâ”€â”€ database/         # æ•°æ®åº“Schemaå’Œè¿ç§»æ–‡ä»¶
â””â”€â”€ docs/             # é¡¹ç›®æ–‡æ¡£
```

### ç¯å¢ƒè¦æ±‚
- Node.js: 16.x æˆ–æ›´é«˜ç‰ˆæœ¬
- NPM: 8.x æˆ–æ›´é«˜ç‰ˆæœ¬
- æ•°æ®åº“: SQLite (è‡ªåŠ¨åˆ›å»º)

### å¼€å‘å‘½ä»¤

#### é¡¹ç›®å¯åŠ¨
```bash
# å¼€å‘æ¨¡å¼ - åŒæ—¶å¯åŠ¨å‰åç«¯
npm run dev

# åˆ†åˆ«å¯åŠ¨
cd backend && npm run dev    # åç«¯å¼€å‘æœåŠ¡å™¨
cd frontend && npm run dev   # å‰ç«¯å¼€å‘æœåŠ¡å™¨
```

#### æ„å»ºå’Œéƒ¨ç½²
```bash
# å‰ç«¯æ„å»º
cd frontend && npm run build

# åç«¯æ„å»º
cd backend && npm run build

# ç”Ÿäº§æ¨¡å¼å¯åŠ¨
cd backend && npm run start
```

#### ä»£ç è´¨é‡
```bash
# åç«¯
cd backend
npm run lint          # ESLint æ£€æŸ¥
npm run lint:fix      # è‡ªåŠ¨ä¿®å¤linté—®é¢˜
npm run format        # Prettier æ ¼å¼åŒ–

# å‰ç«¯
cd frontend
npm run lint          # ESLint æ£€æŸ¥
npm run format        # Prettier æ ¼å¼åŒ–
npm run type-check    # TypeScript ç±»å‹æ£€æŸ¥
```

#### æµ‹è¯•
```bash
# åç«¯æµ‹è¯•
cd backend && npm test

# å‰ç«¯æµ‹è¯•
cd frontend && npm test
```

#### æ•°æ®åº“æ“ä½œ
```bash
cd backend
npm run migrate       # è¿è¡Œæ•°æ®åº“è¿ç§»
npm run seed         # æ’å…¥ç§å­æ•°æ®

# æ‰‹åŠ¨æ“ä½œSQLiteæ•°æ®åº“
sqlite3 database/jiehe.db
```

## ğŸ¯ æ ¸å¿ƒæ¶æ„

### åç«¯æ¶æ„ (backend/)
- **æ¡†æ¶**: Koa2 + TypeScript
- **æ•°æ®åº“**: SQLite (WALæ¨¡å¼) + è¿›ç¨‹å†…ç¼“å­˜
- **è®¤è¯**: JWTåŒä»¤ç‰Œæœºåˆ¶
- **å®æ—¶é€šä¿¡**: Socket.IO (åŸºäºå®¶åº­æˆ¿é—´éš”ç¦»)
- **AIé›†æˆ**: é€šä¹‰åƒé—®API (é¢„ç®—æ§åˆ¶)

### å‰ç«¯æ¶æ„ (frontend/)
- **æ¡†æ¶**: Vue 3 + Vite + TypeScript
- **UIåº“**: Vant UI (ç§»åŠ¨ç«¯ä¼˜åŒ–)
- **çŠ¶æ€ç®¡ç†**: Pinia
- **è·¯ç”±**: Vue Router
- **PWA**: æ”¯æŒç¦»çº¿åŠŸèƒ½å’Œåº”ç”¨å®‰è£…

### æ•°æ®åº“è®¾è®¡
- **æ ¸å¿ƒè¡¨**: users, families, family_members
- **åŠŸèƒ½æ¨¡å—**: tasks, inventory_*, menus, calendar_events, messages
- **AIç³»ç»Ÿ**: ai_budget_records, cost_records
- **åˆ†æç³»ç»Ÿ**: analysis_reports, purchasing_plans

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·å’Œå®¶åº­ç®¡ç†
- ç”¨æˆ·æ³¨å†Œ/ç™»å½• (JWTè®¤è¯)
- å®¶åº­åˆ›å»ºå’ŒåŠ å…¥ (é‚€è¯·ç æœºåˆ¶)
- æˆå‘˜æƒé™ç®¡ç† (admin/memberè§’è‰²)

### 2. ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ
- ä»»åŠ¡CRUDæ“ä½œ
- ä»»åŠ¡åˆ†é…å’ŒçŠ¶æ€ç®¡ç†
- ä¼˜å…ˆçº§å’Œåˆ†ç±»ç®¡ç†

### 3. æ™ºèƒ½åº“å­˜ç®¡ç†
- å¤šæ‰¹æ¬¡FIFOåº“å­˜ç®¡ç†
- è¿‡æœŸæé†’å’Œæ™ºèƒ½é€šçŸ¥
- åº“å­˜åˆ†ç±»å’Œç»Ÿè®¡åˆ†æ

### 4. ç‚¹èœæŠ•ç¥¨ç³»ç»Ÿ
- èœå•åˆ›å»ºå’Œèœå“ç®¡ç†
- æŠ•ç¥¨æœºåˆ¶ (ç‚¹èµ/åå¯¹/ä¸­æ€§)
- æŠ•ç¥¨ç»Ÿè®¡å’Œç»“æœåˆ†æ

### 5. å…±äº«æ—¥å†ç³»ç»Ÿ
- äº‹ä»¶CRUDå’Œé‡å¤è§„åˆ™
- å¤šäººå‚ä¸å’ŒçŠ¶æ€ç®¡ç†
- æ™ºèƒ½æé†’ç³»ç»Ÿ

### 6. å®¶åº­ç•™è¨€æ¿
- ç•™è¨€å‘å¸ƒå’Œ@æé†’åŠŸèƒ½
- ååº”ç³»ç»Ÿå’Œè¯„è®ºåŠŸèƒ½
- å®æ—¶æ¶ˆæ¯æ¨é€

### 7. AIæ™ºèƒ½åŠŸèƒ½
- åŸºäºåº“å­˜çš„èœè°±æ¨è
- æ™ºèƒ½ä»»åŠ¡å»ºè®®
- æ™ºèƒ½è´­ç‰©æ¸…å•ç”Ÿæˆ
- æˆæœ¬åˆ†æå’Œé¢„ç®—ç®¡ç†

## ğŸ”Œ APIæ¶æ„

### RESTful API è®¾è®¡æ¨¡å¼
- `/api/auth/*` - ç”¨æˆ·è®¤è¯
- `/api/families/*` - å®¶åº­ç®¡ç†
- `/api/families/:id/tasks/*` - ä»»åŠ¡ç®¡ç†
- `/api/families/:id/inventory/*` - åº“å­˜ç®¡ç†
- `/api/families/:id/menus/*` - ç‚¹èœç³»ç»Ÿ
- `/api/families/:id/events/*` - æ—¥å†äº‹ä»¶
- `/api/families/:id/messages/*` - ç•™è¨€æ¿
- `/api/ai/*` - AIæœåŠ¡

### Socket.IO å®æ—¶é€šä¿¡
- åŸºäºfamily_idçš„æˆ¿é—´éš”ç¦»
- å®æ—¶ä»»åŠ¡æ›´æ–°ã€åº“å­˜å˜åŒ–ã€æ–°æ¶ˆæ¯æ¨é€
- åœ¨çº¿çŠ¶æ€å’Œè¾“å…¥æç¤º

## âš ï¸ å¼€å‘æ³¨æ„äº‹é¡¹

### æ•°æ®åº“æ“ä½œ
- ä½¿ç”¨SQLite WALæ¨¡å¼ï¼Œæ”¯æŒå¹¶å‘è¯»å†™
- æ‰€æœ‰æ•°æ®æ“ä½œéƒ½åº”åŒ…å«family_idéš”ç¦»
- ä½¿ç”¨soft delete (is_activeå­—æ®µ) è€Œéç‰©ç†åˆ é™¤

### AIæœåŠ¡ä½¿ç”¨
- æ‰€æœ‰AIè°ƒç”¨éƒ½è¦è¿›è¡Œé¢„ç®—æ§åˆ¶
- å¤±è´¥æ—¶è¦æœ‰æœ¬åœ°ç®—æ³•é™çº§
- è®°å½•AIä½¿ç”¨æƒ…å†µåˆ°ai_budget_recordsè¡¨

### æƒé™æ§åˆ¶
- æ‰€æœ‰APIéƒ½éœ€è¦JWTè®¤è¯
- å®¶åº­çº§åˆ«çš„æ•°æ®éš”ç¦»
- admin/memberè§’è‰²æƒé™åŒºåˆ†

### å‰ç«¯å¼€å‘
- ä½¿ç”¨Vant UIç»„ä»¶ï¼Œä¿æŒç§»åŠ¨ç«¯ä½“éªŒ
- åˆ©ç”¨PWAåŠŸèƒ½æ”¯æŒç¦»çº¿ä½¿ç”¨
- ä»£ç åˆ†å‰²æŒ‰åŠŸèƒ½æ¨¡å—è¿›è¡Œ

### é”™è¯¯å¤„ç†
- ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
- è¯¦ç»†çš„æ—¥å¿—è®°å½• (logs/ç›®å½•)
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

### æ–‡ä»¶ä¸Šä¼ 
- é™åˆ¶æ–‡ä»¶ç±»å‹å’Œå¤§å° (10MB)
- å­˜å‚¨åœ¨uploads/ç›®å½•
- æ”¯æŒå›¾ç‰‡ã€éŸ³é¢‘ã€PDFæ ¼å¼

## ğŸ§ª æµ‹è¯•å’Œè°ƒè¯•

### æœ¬åœ°å¼€å‘æµ‹è¯•
- ä½¿ç”¨curlæˆ–Postmanæµ‹è¯•API
- æµè§ˆå™¨å¼€å‘è€…å·¥å…·è°ƒè¯•å‰ç«¯
- SQLiteæ•°æ®åº“ç›´æ¥æŸ¥è¯¢

### æ—¥å¿—æŸ¥çœ‹
```bash
cd backend
tail -f logs/app.log      # åº”ç”¨æ—¥å¿—
tail -f logs/error.log    # é”™è¯¯æ—¥å¿—
```

### æ•°æ®åº“é‡ç½®
```bash
cd backend
rm -f database/jiehe.db   # åˆ é™¤æ•°æ®åº“æ–‡ä»¶
npm run dev               # é‡å¯è‡ªåŠ¨åˆ›å»ºæ–°æ•°æ®åº“
```

## ğŸ¨ å‰ç«¯ç»„ä»¶æŒ‡å—

### é¡µé¢ç»„ä»¶ä½ç½®
- ä¸»è¦åŠŸèƒ½é¡µé¢: `frontend/src/views/`
- é€šç”¨ç»„ä»¶: `frontend/src/components/`
- APIæœåŠ¡: `frontend/src/api/`
- çŠ¶æ€ç®¡ç†: `frontend/src/stores/`

### ç§»åŠ¨ç«¯é€‚é…
- æ‰€æœ‰é¡µé¢éƒ½è¦é€‚é…ç§»åŠ¨ç«¯
- ä½¿ç”¨Vant UIçš„ç§»åŠ¨ç«¯ç»„ä»¶
- æ”¯æŒè§¦æ‘¸æ‰‹åŠ¿å’Œå“åº”å¼è®¾è®¡

### PWAåŠŸèƒ½
- è‡ªåŠ¨æ›´æ–°å’Œç¼“å­˜ç­–ç•¥
- æ”¯æŒåº”ç”¨å®‰è£…åˆ°æ¡Œé¢
- ç¦»çº¿æ•°æ®å­˜å‚¨å’ŒåŒæ­¥

## ğŸ“š é‡è¦æ–‡ä»¶è¯´æ˜

- `backend/src/app.ts` - åç«¯å…¥å£æ–‡ä»¶
- `backend/database/schema.sql` - å®Œæ•´æ•°æ®åº“æ¶æ„
- `frontend/src/main.ts` - å‰ç«¯å…¥å£æ–‡ä»¶
- `frontend/vite.config.ts` - Viteé…ç½®å’ŒPWAè®¾ç½®
- `.env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿

## ğŸ”§ é…ç½®å»ºè®®

### å¼€å‘ç¯å¢ƒé…ç½®
1. å¤åˆ¶ `backend/.env.example` åˆ° `backend/.env`
2. é…ç½®JWTå¯†é’¥å’Œé€šä¹‰åƒé—®APIå¯†é’¥
3. è®¾ç½®åˆé€‚çš„ç«¯å£å’ŒCORSé…ç½®

### ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹
- ä½¿ç”¨å¼ºå¯†ç çš„JWTå¯†é’¥
- é…ç½®é€‚å½“çš„æ–‡ä»¶ä¸Šä¼ é™åˆ¶
- è®¾ç½®AIé¢„ç®—é™åˆ¶é¿å…è¶…æ”¯
- é…ç½®HTTPSå’Œå®‰å…¨å¤´éƒ¨

é€šè¿‡ä»¥ä¸ŠæŒ‡å¯¼ï¼ŒClaude Code å¯ä»¥æœ‰æ•ˆåœ°åœ¨æ­¤é¡¹ç›®ä¸­è¿›è¡Œå¼€å‘å’Œç»´æŠ¤å·¥ä½œã€‚