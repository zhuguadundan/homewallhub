# "家和"智能家庭协作助手 - 详细开发计划

> 版本: 2.0（增强版）
> 日期: 2025年9月25日
> 包含库存管理功能 + AI智能推荐

---

## 📋 产品概述

### 产品愿景
通过一个集成的、智能的移动网页应用，简化家庭任务分配与餐饮协调，**新增智能库存管理**，减少沟通成本，促进家庭成员间的和谐与协作，让家庭生活更轻松、更有条理，同时减少食材浪费。

### 核心功能升级
- **家务任务分配** - 智能任务管理和分配
- **家庭点菜系统** - 收集家人用餐偏好
- **🆕 智能库存管理** - 食材库存录入、过期提醒、AI菜谱推荐
- **🆕 共享日历** - 家庭成员日程管理、事件提醒、冲突检测
- **🆕 家庭留言板** - 私密留言交流、@提醒、多媒体支持
- **AI智能助手** - 基于库存的菜谱推荐、自然语言任务创建、日程智能解析
- **实时通知** - WebSocket推送、Webhook集成、多渠道提醒

---

## 🛠️ 技术选型方案（轻量化MVP版）

### **推荐方案：快速验证轻量化方案**

```
前端: Vue 3 + Vite + TypeScript + Vant UI
后端: Node.js + Koa2 + TypeScript
数据库: SQLite (WAL模式) + 进程内缓存
AI集成: 通义千问API (预算控制)
实时通信: Socket.IO (单实例，支持房间隔离)
文件存储: 本地磁盘直存 (抽象接口设计)
部署: Docker + Nginx (去除PM2双管理)
```

### **轻量化设计理念**
- **去除不必要依赖**: MVP阶段去除Redis、MinIO等重组件
- **本地优先策略**: 文件本地存储，进程内缓存，单实例部署
- **抽象接口设计**: 为未来扩展预留平滑迁移路径
- **成本控制优先**: AI调用预算控制，避免意外超支

### **SQLite选择优势**
- ✅ **零配置**: 无需独立数据库服务器，简化部署
- ✅ **高性能**: 对于中小型应用，读写性能优异
- ✅ **可靠性**: 事务支持完整，数据安全性高
- ✅ **成本低**: 无额外的数据库服务费用
- ✅ **易维护**: 单文件数据库，备份和迁移简单

### **技术选型对比分析**

| 方案组件 | 轻量化选择 | 传统方案 | 轻量化选择理由 |
|---------|------|---------|---------|
| 前端框架 | Vue 3 | React, Angular | 学习曲线平缓，组合式API适合移动端 |
| UI组件库 | Vant | Ant Design Mobile | 专为移动端设计，国内用户体验好 |
| 后端框架 | Koa2 | Express, Fastify | 中间件机制清晰，异步处理优秀 |
| 数据库 | SQLite (WAL) | PostgreSQL, MySQL | 零配置，单文件，适合MVP快速验证 |
| 实时通信 | Socket.IO (单实例) | Redis + Socket.IO | 家庭场景需要房间隔离，双向交互 |
| 缓存系统 | 进程内LRU | Redis | MVP阶段单实例足够，减少依赖复杂度 |
| AI服务 | 通义千问 (预算控制) | OpenAI, 百度千帆 | 中文理解好，价格便宜，预算可控 |
| 文件存储 | 本地磁盘直存 | MinIO, OSS | 抽象接口设计，MVP阶段简化部署 |

### **迁移路径设计**
```
轻量化阶段 → 生产级扩展:
├── 文件存储: 本地直存 → MinIO/OSS
├── 缓存系统: 进程内存 → Redis集群
├── 实时通信: 单实例Socket.IO → 多实例+Redis适配器
├── 数据库: 单SQLite → 读写分离/分库分表
└── 部署架构: 单容器 → 微服务+负载均衡
```

---

## 🏗️ 轻量化系统架构设计（MVP版）

```
┌─────────────────┐              ┌─────────────────┐
│   移动端 PWA    │              │  第三方集成(延期)│
│                │              │                │
│ • Vue 3 + Vant │              │ • 微信群机器人   │
│ • 简化离线支持   │              │ • 外部菜谱API   │
│ • Socket.IO连接 │              │ • 日历同步API   │
│ • 📦库存管理UI   │              │ (MVP阶段延期)   │
│ • 📅日历管理UI   │              │                │
│ • 💬留言板UI    │              │                │
└─────────┬───────┘              └─────────────────┘
          │
          │              ┌───────────────┐
          │              │  Nginx反向代理 │
          │              │  SSL终结      │
          │              │  静态文件服务  │
          │              └───────┬───────┘
          │                      │
          └──────────────────────┘

      ┌─────────────────────────────────────────┐
      │         轻量化单体应用                    │
      │                                       │
      │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐│
      │  │用户 │ │任务 │ │库存 │ │菜单 │ │AI   ││
      │  │认证 │ │管理 │ │管理 │ │点菜 │ │服务 ││
      │  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘│
      │                                       │
      │  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐       │
      │  │日历 │ │留言 │ │通知 │ │文件 │       │
      │  │事件 │ │管理 │ │推送 │ │存储 │       │
      │  └─────┘ └─────┘ └─────┘ └─────┘       │
      │                                       │
      │  ┌─────────────────────────────────┐   │
      │  │        数据访问层               │   │
      │  │ • SQLite WAL • 进程内缓存       │   │
      │  │ • Socket.IO • JWT认证          │   │
      │  └─────────────────────────────────┘   │
      └─────────────────┬───────────────────────┘
                        │
      ┌─────────────────▼───────────────────────┐
      │              本地存储层                  │
      │                                       │
      │ ┌─────────────┐  ┌─────────────────┐   │
      │ │   SQLite    │  │  本地文件存储    │   │
      │ │   (WAL模式)  │  │                │   │
      │ │             │  │ storage/        │   │
      │ │📦库存数据   │  │ ├─avatars/      │   │
      │ │📋任务数据   │  │ ├─ingredients/  │   │
      │ │🍽️菜单数据   │  │ └─messages/     │   │
      │ │📅日历事件   │  │                │   │
      │ │💬留言数据   │  │ backups/        │   │
      │ │👤用户数据   │  │ └─YYYYMMDD.db   │   │
      │ └─────────────┘  └─────────────────┘   │
      └─────────────────────────────────────────┘
```

**轻量化架构特性**：
- **单体应用设计**：功能模块化但部署简化，便于快速验证
- **本地文件存储**：直接磁盘存储，配置抽象接口支持未来迁移
- **进程内缓存**：LRU缓存策略，避免Redis依赖
- **Socket.IO房间隔离**：每个家庭独立房间，支持实时协作
- **SQLite WAL模式**：并发读写优化，事务完整性保证
- **AI预算控制**：智能调用频次限制，成本可控
- **简化离线支持**：基础离线读取，延期复杂冲突处理
- **JWT无状态认证**：无需session存储，水平扩展友好

---

## 📊 数据库设计（SQLite + 库存管理 + 日历 + 留言板）

### 核心表结构

```sql
-- 用户表
CREATE TABLE users (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    phone TEXT UNIQUE NOT NULL,
    nickname TEXT,
    avatar_url TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 家庭表
CREATE TABLE families (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    name TEXT NOT NULL,
    invite_code TEXT UNIQUE NOT NULL,
    creator_id TEXT REFERENCES users(id),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 家庭成员关系表
CREATE TABLE family_members (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    family_id TEXT REFERENCES families(id) ON DELETE CASCADE,
    user_id TEXT REFERENCES users(id) ON DELETE CASCADE,
    role TEXT DEFAULT 'member', -- 'admin', 'member'
    joined_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(family_id, user_id)
);

-- 🆕 食材分类表
CREATE TABLE ingredient_categories (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    name TEXT NOT NULL, -- 蔬菜、肉类、调料、主食等
    icon TEXT, -- 分类图标
    sort_order INTEGER DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 🆕 食材基础信息表
CREATE TABLE ingredients (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    name TEXT NOT NULL, -- 食材名称：西红柿、鸡蛋、猪肉等
    category_id TEXT REFERENCES ingredient_categories(id),
    unit TEXT NOT NULL DEFAULT '个', -- 计量单位：kg、个、包、瓶等
    shelf_life INTEGER, -- 保质期天数
    storage_tip TEXT, -- 保存建议
    nutrition_info TEXT, -- 营养信息JSON
    image_url TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 🆕 家庭库存表（支持多批次，移除唯一约束）
CREATE TABLE family_inventory (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    family_id TEXT REFERENCES families(id) ON DELETE CASCADE,
    ingredient_id TEXT REFERENCES ingredients(id),
    quantity REAL NOT NULL DEFAULT 0, -- 数量
    unit TEXT NOT NULL DEFAULT '个', -- 计量单位
    purchase_date DATE, -- 购买日期
    expire_date DATE, -- 过期日期
    location TEXT DEFAULT '冰箱' CHECK (location IN ('冰箱', '冷冻', '常温', '储藏室')), -- 存放位置
    unit_price REAL, -- 单价（可选）
    notes TEXT, -- 备注
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
    -- 移除唯一约束，支持同种食材多批次记录
);

-- 🆕 文件存储元数据表（支持轻量化本地存储）
CREATE TABLE files (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    family_id TEXT REFERENCES families(id) ON DELETE CASCADE,
    owner_id TEXT REFERENCES users(id),
    original_name TEXT NOT NULL,
    mime TEXT NOT NULL CHECK (mime IN ('image/png', 'image/jpeg', 'image/webp', 'audio/mpeg', 'application/pdf')),
    size INTEGER NOT NULL CHECK (size <= 10485760), -- 最大10MB
    driver TEXT NOT NULL DEFAULT 'local' CHECK (driver IN ('local', 'minio')),
    path_or_key TEXT NOT NULL,
    checksum TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 🆕 库存变更记录表
CREATE TABLE inventory_logs (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    family_id TEXT REFERENCES families(id),
    ingredient_id TEXT REFERENCES ingredients(id),
    change_type TEXT NOT NULL, -- 'add', 'consume', 'expire', 'waste'
    quantity_change REAL NOT NULL, -- 变更数量（正数增加，负数减少）
    quantity_after REAL NOT NULL, -- 变更后数量
    reason TEXT, -- 变更原因：购买、做菜、过期等
    operator_id TEXT REFERENCES users(id),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 任务表
CREATE TABLE tasks (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    family_id TEXT REFERENCES families(id) ON DELETE CASCADE,
    title TEXT NOT NULL,
    description TEXT,
    creator_id TEXT REFERENCES users(id),
    assignee_id TEXT REFERENCES users(id),
    status TEXT DEFAULT 'pending',
    due_date DATETIME,
    repeat_type TEXT DEFAULT 'once',
    repeat_config TEXT, -- JSON格式
    completion_photo_url TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    completed_at DATETIME
);

-- 菜单表
CREATE TABLE menus (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    family_id TEXT REFERENCES families(id) ON DELETE CASCADE,
    title TEXT NOT NULL,
    description TEXT,
    meal_date DATE NOT NULL,
    meal_type TEXT DEFAULT 'dinner',
    creator_id TEXT REFERENCES users(id),
    status TEXT DEFAULT 'active',
    deadline DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 菜品表（增强版，关联食材）
CREATE TABLE dishes (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    menu_id TEXT REFERENCES menus(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    description TEXT,
    image_url TEXT,
    difficulty_level INTEGER DEFAULT 1, -- 🆕 难度等级 1-5
    cooking_time INTEGER, -- 🆕 预计烹饪时间（分钟）
    serving_size INTEGER DEFAULT 4, -- 🆕 适合人数
    recipe_url TEXT, -- 🆕 菜谱链接
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 🆕 菜品食材关联表
CREATE TABLE dish_ingredients (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    dish_id TEXT REFERENCES dishes(id) ON DELETE CASCADE,
    ingredient_id TEXT REFERENCES ingredients(id),
    quantity REAL NOT NULL, -- 所需数量
    is_essential BOOLEAN DEFAULT 1, -- 是否必需（1:必需, 0:可选）
    substitute_ingredients TEXT, -- 可替代食材ID，JSON数组格式
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 点菜记录表（移除JSON格式dish_ids）
CREATE TABLE orders (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    menu_id TEXT REFERENCES menus(id) ON DELETE CASCADE,
    user_id TEXT REFERENCES users(id),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(menu_id, user_id)
);

-- 🆕 订单-菜品关联表
CREATE TABLE order_dishes (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    order_id TEXT REFERENCES orders(id) ON DELETE CASCADE,
    dish_id TEXT REFERENCES dishes(id) ON DELETE CASCADE,
    quantity INTEGER NOT NULL DEFAULT 1 CHECK (quantity > 0),
    notes TEXT, -- 特殊要求备注
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(order_id, dish_id)
);

-- Webhook配置表
CREATE TABLE webhooks (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    family_id TEXT REFERENCES families(id) ON DELETE CASCADE,
    name TEXT,
    url TEXT NOT NULL,
    events TEXT NOT NULL, -- JSON数组
    is_active BOOLEAN DEFAULT 1,
    secret_token TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 🆕 家庭成员配置扩展
ALTER TABLE family_members ADD COLUMN calendar_color TEXT DEFAULT '#1890ff'; -- 日历颜色标识
ALTER TABLE family_members ADD COLUMN timezone TEXT DEFAULT 'Asia/Shanghai'; -- 时区设置

-- 🆕 日历事件分类表
CREATE TABLE calendar_categories (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    family_id TEXT REFERENCES families(id) ON DELETE CASCADE,
    name TEXT NOT NULL, -- 工作、生活、纪念日、家务、聚餐等
    icon TEXT, -- 分类图标
    color TEXT DEFAULT '#1890ff', -- 分类颜色
    is_default BOOLEAN DEFAULT 0, -- 是否为系统默认分类
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 🆕 日历事件表
CREATE TABLE calendar_events (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    family_id TEXT REFERENCES families(id) ON DELETE CASCADE,
    creator_id TEXT REFERENCES users(id),
    owner_id TEXT REFERENCES users(id), -- 事件归属人（可与创建人不同）
    category_id TEXT REFERENCES calendar_categories(id),
    title TEXT NOT NULL,
    description TEXT,
    location TEXT, -- 事件地点
    start_datetime DATETIME NOT NULL, -- 开始时间
    end_datetime DATETIME NOT NULL, -- 结束时间
    all_day BOOLEAN DEFAULT 0, -- 是否全天事件
    visibility TEXT DEFAULT 'family', -- 'private', 'family' 隐私设置
    status TEXT DEFAULT 'confirmed', -- 'confirmed', 'tentative', 'cancelled'

    -- 重复事件配置
    recurrence_rule TEXT, -- RRULE格式的重复规则
    recurrence_end_date DATETIME, -- 重复结束日期
    is_recurring BOOLEAN DEFAULT 0,
    parent_event_id TEXT REFERENCES calendar_events(id), -- 重复事件的父事件ID

    -- 提醒配置
    reminder_config TEXT, -- JSON格式：[{"type":"push","minutes":30},{"type":"webhook","minutes":60}]

    -- 关联功能
    related_type TEXT, -- 'task', 'menu', 'inventory' 关联的功能类型
    related_id TEXT, -- 关联的具体记录ID

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 🆕 事件参与者表（用于家庭活动多人参与场景）
CREATE TABLE event_participants (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    event_id TEXT REFERENCES calendar_events(id) ON DELETE CASCADE,
    user_id TEXT REFERENCES users(id),
    status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'accepted', 'declined')),
    response_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(event_id, user_id) -- 防止重复参与
);

-- 🆕 事件提醒记录表
CREATE TABLE event_reminders (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    event_id TEXT REFERENCES calendar_events(id) ON DELETE CASCADE,
    user_id TEXT REFERENCES users(id),
    reminder_type TEXT NOT NULL CHECK (reminder_type IN ('push', 'socketio')), -- 轻量化版本仅支持这两种
    trigger_time DATETIME NOT NULL, -- 提醒触发时间
    status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'sent', 'failed')),
    sent_at DATETIME,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(event_id, user_id, trigger_time, reminder_type) -- 防止重复提醒
);

-- 🆕 家庭留言板分类表
CREATE TABLE message_categories (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    family_id TEXT REFERENCES families(id) ON DELETE CASCADE,
    name TEXT NOT NULL, -- 重要通知、日常聊天、温馨提醒、紧急事项等
    icon TEXT,
    color TEXT DEFAULT '#52c41a',
    priority_level INTEGER DEFAULT 1, -- 优先级 1-5
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 🆕 家庭留言表
CREATE TABLE family_messages (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    family_id TEXT REFERENCES families(id) ON DELETE CASCADE,
    sender_id TEXT REFERENCES users(id),
    category_id TEXT REFERENCES message_categories(id),
    message_type TEXT DEFAULT 'text', -- 'text', 'image', 'voice', 'file'
    content TEXT NOT NULL, -- 消息内容
    media_urls TEXT, -- 媒体文件URL，JSON数组格式

    -- @提醒功能
    mentioned_users TEXT, -- 被@的用户ID，JSON数组格式
    is_pinned BOOLEAN DEFAULT 0, -- 是否置顶

    -- 定时发送
    scheduled_send_time DATETIME, -- 定时发送时间
    is_scheduled BOOLEAN DEFAULT 0,

    -- 消息状态
    status TEXT DEFAULT 'sent', -- 'draft', 'scheduled', 'sent', 'deleted'
    priority TEXT DEFAULT 'normal', -- 'low', 'normal', 'high', 'urgent'

    -- 相关功能关联
    related_type TEXT, -- 'task', 'menu', 'inventory', 'event'
    related_id TEXT, -- 关联的具体记录ID

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 🆕 留言已读状态表
CREATE TABLE message_read_status (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    message_id TEXT REFERENCES family_messages(id) ON DELETE CASCADE,
    user_id TEXT REFERENCES users(id),
    read_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(message_id, user_id)
);

-- 🆕 留言回复表
CREATE TABLE message_replies (
    id TEXT PRIMARY KEY DEFAULT (lower(hex(randomblob(16)))),
    parent_message_id TEXT REFERENCES family_messages(id) ON DELETE CASCADE,
    sender_id TEXT REFERENCES users(id),
    content TEXT NOT NULL,
    message_type TEXT DEFAULT 'text',
    media_urls TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 🆕 创建索引优化查询性能
CREATE INDEX idx_family_inventory_family_expire ON family_inventory(family_id, expire_date);
CREATE INDEX idx_family_inventory_ingredient ON family_inventory(family_id, ingredient_id);
CREATE INDEX idx_inventory_logs_family_date ON inventory_logs(family_id, created_at);
CREATE INDEX idx_tasks_family_status ON tasks(family_id, status);
CREATE INDEX idx_tasks_assignee_status ON tasks(assignee_id, status);
CREATE INDEX idx_order_dishes_order ON order_dishes(order_id);
CREATE INDEX idx_dish_ingredients_dish ON dish_ingredients(dish_id);
CREATE INDEX idx_calendar_events_family_date ON calendar_events(family_id, start_datetime);
CREATE INDEX idx_calendar_events_owner_date ON calendar_events(owner_id, start_datetime);
CREATE INDEX idx_family_messages_family_time ON family_messages(family_id, created_at DESC);
CREATE INDEX idx_message_read_status_user ON message_read_status(user_id);
CREATE INDEX idx_event_reminders_trigger ON event_reminders(trigger_time, status);
CREATE INDEX idx_files_family_time ON files(family_id, created_at);
```

### 预置数据

```sql
-- 🆕 插入基础数据
INSERT INTO ingredient_categories (name, icon, sort_order) VALUES
('蔬菜', '🥬', 1),
('肉类', '🥩', 2),
('海鲜', '🐟', 3),
('主食', '🍚', 4),
('调料', '🧂', 5),
('水果', '🍎', 6),
('零食', '🍪', 7),
('饮品', '🥤', 8);

INSERT INTO ingredients (name, category_id, unit, shelf_life) VALUES
('西红柿', (SELECT id FROM ingredient_categories WHERE name='蔬菜'), 'kg', 7),
('鸡蛋', (SELECT id FROM ingredient_categories WHERE name='肉类'), '个', 21),
('猪肉', (SELECT id FROM ingredient_categories WHERE name='肉类'), 'kg', 3),
('大米', (SELECT id FROM ingredient_categories WHERE name='主食'), 'kg', 365),
('生抽', (SELECT id FROM ingredient_categories WHERE name='调料'), '瓶', 730);

-- 🆕 系统预设日历分类
INSERT INTO calendar_categories (family_id, name, icon, color, is_default) VALUES
(NULL, '工作', '💼', '#1890ff', 1),
(NULL, '生活', '🏠', '#52c41a', 1),
(NULL, '纪念日', '🎉', '#f5222d', 1),
(NULL, '家务', '🧹', '#fa8c16', 1),
(NULL, '聚餐', '🍽️', '#722ed1', 1),
(NULL, '运动', '🏃', '#13c2c2', 1),
(NULL, '购物', '🛒', '#eb2f96', 1);

-- 🆕 系统预设留言分类
INSERT INTO message_categories (family_id, name, icon, color, priority_level) VALUES
(NULL, '重要通知', '📢', '#f5222d', 5),
(NULL, '日常聊天', '💬', '#1890ff', 2),
(NULL, '温馨提醒', '💝', '#fa8c16', 3),
(NULL, '紧急事项', '🚨', '#ff4d4f', 5),
(NULL, '生活分享', '📷', '#52c41a', 1);
```

---

## 🎨 UX/UI设计体系（参考FamilyWall）

### **设计理念与原则**

**核心设计理念**: 以"简约而不简单"为核心，打造温暖、直观的家庭协作体验

```
设计价值观:
├── 🏠 家庭温暖感 - 温馨配色 + 圆润元素 + 情感化图标
├── ⚡ 操作高效性 - 一步到位 + 智能预测 + 快捷入口
├── 👥 老少皆宜性 - 大按钮 + 清晰层级 + 无障碍设计
└── 🔄 一致性体验 - 统一组件 + 标准交互 + 品牌延续
```

### **视觉设计系统**

#### **配色方案（温馨家庭风）**
```
主色调系统:
├── 🎨 主品牌色: #52C41A (温暖绿) - 生机与和谐
├── 🎯 辅助色调: #1890FF (信任蓝) - 可靠与专业
├── 🔥 功能色彩: #FA8C16 (活力橙) - 紧急与提醒
├── 💝 情感色彩: #EB2F96 (温馨粉) - 关爱与亲密
└── 🌙 中性色系: #F5F5F5~#262626 - 层次与平衡

语义化色彩应用:
├── ✅ 成功状态: #52C41A (完成任务、库存充足)
├── ⚠️ 警告状态: #FAAD14 (即将过期、需要关注)
├── 🚨 错误状态: #FF4D4F (过期、缺失、冲突)
├── ℹ️ 信息状态: #1890FF (提示、说明、引导)
└── 🌟 特殊状态: #722ED1 (AI推荐、智能功能)
```

#### **字体层级系统**
```
字体规范:
├── 🔤 主标题: 24px/Bold - 页面主要信息
├── 📝 副标题: 20px/Medium - 功能模块标题
├── 📄 正文内容: 16px/Regular - 常规信息显示
├── 🏷️ 标签文本: 14px/Medium - 状态、分类标签
├── 📋 辅助文本: 12px/Regular - 时间、描述信息
└── 🔗 链接按钮: 16px/Medium - 操作性文本
```

#### **间距与布局网格**
```
间距系统 (8px基准):
├── 🔸 微间距: 4px - 相关元素间距
├── 🔹 小间距: 8px - 组件内元素间距
├── 🔶 中间距: 16px - 卡片内容间距
├── 🔷 大间距: 24px - 功能区块间距
└── 🔺 超大间距: 32px - 页面级别间距

布局网格:
├── 📱 手机端: 16px边距 + 8列网格
├── 🖥️ 平板端: 24px边距 + 12列网格
└── 💻 桌面端: 32px边距 + 16列网格
```

### **交互设计模式**

#### **导航架构（参考FamilyWall简洁风格）**
```
三层导航结构:
├── 🏠 主导航: 底部Tab导航 - 5个核心功能
├── 🧭 次导航: 顶部筛选/分类 - 功能内切换
└── 🔗 深层导航: 面包屑/返回键 - 层级定位
```

#### **手势交互规范**
```
手势操作设计:
├── 👆 点击: 主要操作 - 进入详情/执行功能
├── 👆👆 双击: 快捷操作 - 点赞/收藏/快速编辑
├── 👈 左滑: 快捷菜单 - 编辑/删除/完成
├── 👉 右滑: 返回操作 - 后退/取消选择
├── 👆⬇️ 长按: 上下文菜单 - 多选/拖拽模式
└── 🤏 捏合: 缩放操作 - 日历缩放/图片查看
```

### **组件设计规范**

#### **按钮组件系统**
```
按钮层级设计:
├── 🎯 主要按钮: 高对比度 - 关键操作(提交/确认)
├── 🔲 次要按钮: 中对比度 - 辅助操作(取消/返回)
├── 🔗 文本按钮: 低对比度 - 链接操作(查看更多)
├── 🔘 图标按钮: 纯图标 - 工具栏操作(搜索/筛选)
└── ⚡ 悬浮按钮: 固定位置 - 快速新建功能

状态设计:
├── 🔵 默认状态: 静态显示
├── 🟢 悬停状态: 鼠标悬停反馈
├── 🟡 激活状态: 点击按下反馈
├── ⚪ 禁用状态: 不可操作状态
└── 🔄 加载状态: 异步操作反馈
```

#### **卡片组件设计**
```
卡片类型规范:
├── 📋 信息卡片: 纯展示 - 统计数据/状态显示
├── 🔧 操作卡片: 可交互 - 任务项/食材项
├── 📰 内容卡片: 富媒体 - 留言/菜谱展示
├── 📊 数据卡片: 可视化 - 图表/进度展示
└── 🎴 媒体卡片: 图片为主 - 照片/图像展示

卡片结构:
├── 🏷️ 标题区域: 标题 + 状态标签 + 操作菜单
├── 📄 内容区域: 主要信息 + 描述文本
├── 🖼️ 媒体区域: 图片/图标 + 视频/音频
├── 📊 数据区域: 进度条 + 统计数字 + 图表
└── 🔗 操作区域: 主操作 + 次操作 + 更多菜单
```

## 📱 界面设计详情（升级版ASCII图）

### 1. 智能底部导航（FamilyWall风格简化）
```
┌─────────────────────────────────────────┐
│  🏠     🍽️     📦     📅     💬        │
│ 首页    点菜    库存    日历    留言       │
│ ●      ○      ○      ○      ○         │
│                                       │
│        ⚡ 智能悬浮新建按钮 ➕            │
└─────────────────────────────────────────┘

导航特点:
✅ 5个Tab精简布局，减少认知负担
✅ 圆角设计营造亲和感
✅ 活跃状态用实心圆点标识
✅ 悬浮按钮支持快速新建任何内容
```

### 2. 智能首页（仪表盘设计）
```
┌───────────────────────────────────────────────┐
│ 🏠 家和助手    📞 王家  👤头像   [设置⚙️]    │
├───────────────────────────────────────────────┤
│ ✨ 智能建议                     [🔄刷新]     │
│ ┌─────────────────────────────────────────┐   │
│ │🤖 今日推荐: 基于库存推荐"番茄炒蛋"       │   │
│ │💡 提醒: 3样食材将在2天内过期             │   │
│ │📅 临近: 明天下午家庭聚餐                │   │
│ └─────────────────────────────────────────┘   │
│                                             │
│ ⚡ 快速操作  ┌─[📋]─[🍽️]─[📦]─[📅]─[💬]─┐ │
│             │任务  点菜  库存  日历  留言 │ │
│             └─────────────────────────────┘ │
│                                             │
│ 📊 家庭动态                                  │
│ ┌─────────────────────────────────────────┐   │
│ │📋 进行中任务: 3个  🍽️ 今日点菜: 4人     │   │
│ │📦 即将过期: 3样    📅 今日事件: 2个     │   │
│ │💬 未读消息: 2条    👥 在线成员: 3/4     │   │
│ └─────────────────────────────────────────┘   │
│                                             │
│ 🎯 今日重点                                  │
│ ◉ 爸爸: 买菜归来，更新库存 (进行中)           │
│ ○ 妈妈: 准备晚餐食材 (待完成)               │
│ ○ 小明: 学习用品整理 (今日到期)             │
│                                   [查看全部] │
├───────────────────────────────────────────────┤
│  🏠     🍽️     📦     📅     💬   ⚡        │
│ 首页    点菜    库存    日历    留言   ➕       │
└───────────────────────────────────────────────┘
```

### 3. 库存总览界面（卡片化设计）
```
┌───────────────────────────────────────────────┐
│ ← 📦 智能库存    [🔔3] [📊统计] [⚙️设置]      │
├───────────────────────────────────────────────┤
│ 🔍 [搜索食材...] 🔽[全部分类] 📱[扫码添加]     │
│                                             │
│ 🚨 紧急关注 (今明两日过期)                    │
│ ╭─────────────────────────────────────────╮   │
│ │ 🥛 牛奶 500ml  📍冰箱    [今日过期⚠️]   │   │
│ │ 💡 建议: 制作奶昔  🍽️[查看菜谱] [已用完]  │   │
│ ╰─────────────────────────────────────────╯   │
│ ╭─────────────────────────────────────────╮   │
│ │ 🥬 白菜 1kg    📍冰箱    [明日过期⚠️]    │   │
│ │ 💡 建议: 白菜豆腐汤  🍽️[看菜谱] [延期]   │   │
│ ╰─────────────────────────────────────────╯   │
│                                             │
│ 📦 库存分类                                  │
│ ╭─[🥬 蔬菜 6样]──────────────────[展开⌄]─╮   │
│ │ 🍅 西红柿 2kg     📍冰箱   剩余5天      │   │
│ │ 🥕 胡萝卜 0.5kg   📍常温   剩余8天      │   │
│ │ 🧄 大蒜 200g      📍常温   剩余30天     │   │
│ │                              [显示全部] │   │
│ ╰─────────────────────────────────────────╯   │
│                                             │
│ ╭─[🥩 肉类 3样]──────────────────[收起⌃]─╮   │
│ │ 🐔 鸡胸肉 500g    📍冷冻   剩余15天     │   │
│ │ 🥓 培根 300g      📍冷冻   剩余20天     │   │
│ │ 🐟 鲈鱼 1条       📍冷冻   剩余7天      │   │
│ ╰─────────────────────────────────────────╯   │
│                                             │
│                              [⚡ 智能补货提醒] │
│             [➕ 扫码添加] [📷 拍照识别]          │
├───────────────────────────────────────────────┤
│  🏠     🍽️     📦     📅     💬   ⚡        │
│ 首页    点菜    库存    日历    留言   ➕       │
└───────────────────────────────────────────────┘
```

### 4. AI智能菜谱推荐界面（极致体验）
```
┌───────────────────────────────────────────────┐
│ ← 🤖 AI美食家     [👨‍🍳偏好] [🎯精准模式]        │
├───────────────────────────────────────────────┤
│ 💡 基于您的库存和家人口味，为您量身推荐        │
│                                             │
│ 🏆 今日首推 (库存完美匹配)                    │
│ ╭─────────────────────────────────────────╮   │
│ │ 🍅 番茄炒蛋    ⭐⭐⭐⭐⭐  🔥 热门            │   │
│ │ 🕒 15分钟 👥 4人份 😊 零失败  💪 高蛋白     │   │
│ │ ┌─用料清单─┐  ✅ 西红柿 2个 ✅ 鸡蛋 4个  │   │
│ │ │📦 库存充足│  ✅ 生抽 1勺   ✅ 盐 少许   │   │
│ │ │满足度100%│  ✅ 糖 1勺     ✅ 葱花适量  │   │
│ │ └─────────┘  🍽️[看完整菜谱] [立即制作]  │   │
│ ╰─────────────────────────────────────────╯   │
│                                             │
│ 🥈 次优推荐 (需少量补充)                      │
│ ╭─────────────────────────────────────────╮   │
│ │ 🥕 萝卜丝炒蛋  ⭐⭐⭐⭐   🥗 清爽            │   │
│ │ 🕒 12分钟 👥 3人份 😊 简单  🌿 维C丰富     │   │
│ │ ✅ 胡萝卜 0.5kg  ✅ 鸡蛋 3个  ⚠️ 缺香菜   │   │
│ │ 💰 补充成本: ¥3   🛒[加购物车] [替代方案] │   │
│ ╰─────────────────────────────────────────╯   │
│                                             │
│ 🥉 创意推荐 (挑战新口味)                      │
│ ╭─────────────────────────────────────────╮   │
│ │ 🍲 创意蔬菜汤  ⭐⭐⭐   🆕 AI原创          │   │
│ │ 🕒 20分钟 👥 4人份 😊 有趣   🌈 五彩缤纷  │   │
│ │ ❌ 需购买: 豆腐1盒、香菇200g、虾皮50g     │   │
│ │ 💰 预计花费: ¥15  🛒[生成购物单] [收藏]   │   │
│ ╰─────────────────────────────────────────╯   │
│                                             │
│ 🛒 智能购物建议                              │
│ ┌───[📋 本次清单]───┬───[📊 性价比分析]───┐ │
│ │• 香菜 1把         │📈 菜品覆盖率: 85%  │ │
│ │• 豆腐 1盒         │💰 平均成本: ¥6/餐  │ │
│ │• 香菇 200g        │⏱️ 平均耗时: 18分钟 │ │
│ │[🚀 一键下单]      │[📈 查看详细分析]   │ │
│ └─────────────────┴─────────────────────┘ │
│                                             │
│        [🔄 换一批推荐] [💝 分享给家人]         │
├───────────────────────────────────────────────┤
│  🏠     🍽️     📦     📅     💬   ⚡        │
│ 首页    点菜    库存    日历    留言   ➕       │
└───────────────────────────────────────────────┘
```

### 5. 共享日历界面（家庭视图）
```
┌───────────────────────────────────────────────┐
│ ← 📅 家庭日历    [👥全员▼] [📅月▼] [+新建]     │
├───────────────────────────────────────────────┤
│ 🗓️ 2024年9月   ◀ 2024年9月26日 ▶   [今天]   │
│                                             │
│ 日  一  二  三  四  五  六                    │
│ ╭─[1]─[2]─[3]─[4]─[5]─[6]─[7]─╮               │
│ │                🍽️          │               │
│ │     📋       (妈妈)         │               │
│ │  (爸爸)                   │               │
│ ╰─────────────────────────────╯               │
│                                             │
│ ╭─[8]─[9]─[10]─[11]─[12]─[13]─[14]─╮           │
│ │ 🏃     📋     🎉      💼       │           │
│ │(小明) (爸爸) (全家) (小明)      │           │
│ ╰─────────────────────────────────╯           │
│                                             │
│ ╭─[22]─[23]─[24]─[25]─[26●]─[27]─[28]─╮       │
│ │ 💼   🎉           📋    🍽️        │       │
│ │(小明)(全家)      (妈妈) (全家)     │       │
│ ╰─────────────────────────────────────╯       │
│                                             │
│ 📋 今日安排 (2024年9月26日)                  │
│ ╭─────────────────────────────────────────╮   │
│ │ 09:00 📋 爸爸 - 超市采购  📍华润万家     │   │
│ │       💡 已关联库存更新提醒              │   │
│ │ 18:30 🍽️ 全家 - 家庭聚餐  📍海底捞      │   │
│ │       👥 4人参与  🔔 提前30分钟提醒      │   │
│ │ 20:00 📺 小明 - 在线学习  📍书房         │   │
│ │       ⏰ 持续2小时  🔕 勿扰模式          │   │
│ ╰─────────────────────────────────────────╯   │
│                                             │
│ 🎯 明日预告                                  │
│ • 10:00 💪 全家晨练                         │
│ • 14:00 🛒 妈妈采购 (基于AI购物清单)        │
│ • 19:00 📋 小明整理学习用品                  │
│                                             │
│         [📱 手机提醒] [📧 邮件同步]            │
├───────────────────────────────────────────────┤
│  🏠     🍽️     📦     📅     💬   ⚡        │
│ 首页    点菜    库存    日历    留言   ➕       │
└───────────────────────────────────────────────┘
```

### 4. 添加食材界面
```
┌─────────────────────────────────┐
│  ← 添加食材        [🤖AI识别]     │
├─────────────────────────────────┤
│                                │
│ 📷 拍照识别食材                  │
│ ┌─────────────────────────────┐ │
│ │                             │ │
│ │        📷                   │ │
│ │    点击拍照或选择图片          │ │
│ │                             │ │
│ └─────────────────────────────┘ │
│                                │
│ ━━━━━━━ 或手动输入 ━━━━━━━        │
│                                │
│ 🏷️ 食材名称 *                    │
│ ┌─────────────────────────────┐ │
│ │ 西红柿                       │ │
│ └─────────────────────────────┘ │
│                                │
│ 📂 分类选择                      │
│ ┌─────────────────────────────┐ │
│ │ 🥬 蔬菜 ▼                    │ │
│ └─────────────────────────────┘ │
│                                │
│ ⚖️ 数量与单位                    │
│ ┌──────────┐ ┌───────────────┐ │
│ │ 2        │ │ kg ▼         │ │
│ └──────────┘ └───────────────┘ │
│                                │
│ 🛒 购买日期                      │
│ ┌─────────────────────────────┐ │
│ │ 2024-09-25                  │ │
│ └─────────────────────────────┘ │
│                                │
│ ⏰ 预计过期日期                  │
│ ┌─────────────────────────────┐ │
│ │ 2024-10-02  (推荐7天)       │ │
│ └─────────────────────────────┘ │
│                                │
│ 📍 存放位置                      │
│ ○ 冰箱  ○ 冷冻  ○ 常温  ○ 其他   │
│                                │
│        [取消]    [添加到库存]     │
└─────────────────────────────────┘
```

### 5. 过期提醒界面
```
┌─────────────────────────────────┐
│  🔔 过期提醒       [设置提醒⚙️]   │
├─────────────────────────────────┤
│                                │
│ 🚨 今日过期 (1样)                │
│ ┌─────────────────────────────┐ │
│ │ 🥛 牛奶         1盒     今日过期│ │
│ │ 💡建议: 制作奶昔或烘焙使用      │ │
│ │ [立即使用] [延期1天] [已丢弃]  │ │
│ └─────────────────────────────┘ │
│                                │
│ ⚠️ 明日过期 (2样)                │
│ ┌─────────────────────────────┐ │
│ │ 🥬 白菜         1kg     明日过期│ │
│ │ 💡建议: 白菜豆腐汤、炒白菜      │ │
│ │           [查看菜谱]           │ │
│ └─────────────────────────────┘ │
│                                │
│ 📅 3天内过期 (1样)               │
│ ┌─────────────────────────────┐ │
│ │ 🍎 苹果         3个    3天后过期│ │
│ │ 💡建议: 苹果沙拉、苹果汁        │ │
│ │           [查看菜谱]           │ │
│ └─────────────────────────────┘ │
│                                │
│ 🤖 AI建议：                      │
│ "基于即将过期的食材，推荐制作'白菜│
│ 苹果沙拉'，既营养又不浪费！"      │
│                                │
│           [生成菜谱] [忽略]       │
├─────────────────────────────────┤
│📋  🍽️  📦  📅  💬  ➕  👤      │
│任务 点菜 库存 日历 留言 新建 我的 │
└─────────────────────────────────┘
```

### 6. 共享日历界面

#### 6.1 日历月视图
```
┌─────────────────────────────────┐
│  📅 2024年9月    [👥全家▼] [➕]   │
├─────────────────────────────────┤
│                                │
│ 日  一  二  三  四  五  六        │
│ 1   2   3   4   5   6   7        │
│     📋  🍽️      💼              │
│                                │
│ 8   9   10  11  12  13  14       │
│ 🏃  📋      🎉  💼              │
│                                │
│ 15  16  17  18  19  20  21       │
│     🍽️  📋  💼      🛒          │
│                                │
│ 22  23  24  25  26  27  28       │
│ 💼  🎉      📋  🍽️              │
│                                │
│ 29  30                          │
│ 📋  🏃                          │
│                                │
│ 图例：                           │
│ 📋爸爸(蓝) 🍽️妈妈(粉) 💼小明(绿)  │
│ 🎉共同(橙) 🏃个人(紫) 🛒任务(灰)  │
│                                │
├─────────────────────────────────┤
│📋  🍽️  📦  📅  💬  ➕  👤      │
│任务 点菜 库存 日历 留言 新建 我的 │
└─────────────────────────────────┘
```

#### 6.2 创建日历事件
```
┌─────────────────────────────────┐
│  ← 新建事件        [🤖AI助手]     │
├─────────────────────────────────┤
│                                │
│ 💭 快速创建                      │
│ ┌─────────────────────────────┐ │
│ │ "明天下午2点家庭聚餐"          │ │
│ │ "每周日上午9点晨练"            │ │
│ └─────────────────────────────┘ │
│                [AI解析创建🚀]    │
│                                │
│ ━━━━━━━ 或详细设置 ━━━━━━━        │
│                                │
│ 📝 事件标题 *                    │
│ ┌─────────────────────────────┐ │
│ │ 家庭聚餐                     │ │
│ └─────────────────────────────┘ │
│                                │
│ 📂 分类 *                        │
│ ┌─────────────────────────────┐ │
│ │ 🍽️ 聚餐 ▼                    │ │
│ └─────────────────────────────┘ │
│                                │
│ ⏰ 时间设置                      │
│ ┌──────────────┐ □ 全天事件     │
│ │ 2024-09-27   │               │
│ └──────────────┘               │
│ ┌─────┐ 至 ┌─────┐               │
│ │18:30│    │20:30│               │
│ └─────┘    └─────┘               │
│                                │
│ 👤 参与人员                      │
│ □ 爸爸  ☑️ 妈妈  ☑️ 小明  □ 奶奶  │
│                                │
│ 📍 地点                          │
│ ┌─────────────────────────────┐ │
│ │ 海底捞(万达店)               │ │
│ └─────────────────────────────┘ │
│                                │
│ 🔔 提醒设置                      │
│ ☑️ 提前30分钟  ☑️ 提前1天         │
│ □ 微信通知    □ 短信提醒         │
│                                │
│ 🔄 重复设置                      │
│ ○ 不重复  ○ 每天  ○ 每周  ○ 每月 │
│                                │
│        [取消]    [创建事件]       │
└─────────────────────────────────┘
```

### 6. 智能家庭留言板（沉浸式体验）
```
┌───────────────────────────────────────────────┐
│ ← 💬 家庭留言板  [🔥热门▼] [🔍搜索] [✍️写留言]  │
├───────────────────────────────────────────────┤
│ 📌 置顶重要消息                                │
│ ╭─────────────────────────────────────────╮   │
│ │ 📢 妈妈 发布于今天 09:30     [📍置顶] [⋯]│   │
│ │                                        │   │
│ │ 🏠 周末大扫除计划                       │   │
│ │ 这个周六我们一起来个全家大扫除吧！     │   │
│ │ 📋 分工安排已加入日历提醒              │   │
│ │                                        │   │
│ │ 📷 [扫除分工计划图]                    │   │
│ │                                        │   │
│ │ 💬 3条回复  👍 5个赞  👁️ 已读4/4人      │   │
│ │ [💬 查看讨论] [👍 点赞] [📤 分享]       │   │
│ ╰─────────────────────────────────────────╯   │
│                                             │
│ 💬 最新互动                                  │
│                                             │
│ ╭─────────────────────────────────────────╮   │
│ │ 👤 爸爸 📷 生活分享    2小时前   [🔗关联] │   │
│ │                                        │   │
│ │ 🛒 刚从超市回来，买了超多新鲜蔬菜！     │   │
│ │ 大家今晚想吃什么菜呢？                 │   │
│ │                                        │   │
│ │ 📷 [新鲜蔬菜合影] 📦 已自动更新库存     │   │
│ │                                        │   │
│ │ 💭 2条评论  👥 @全体成员               │   │
│ │ ┌─妈妈: 哇，西红柿看起来很新鲜！──┐   │   │
│ │ │小明: 番茄炒蛋！我想吃番茄炒蛋！  │   │   │
│ │ └─────────────────────────────────┘   │   │
│ │ [💬 参与讨论] [🍽️ 推荐菜谱] [👍 点赞]  │   │
│ ╰─────────────────────────────────────────╯   │
│                                             │
│ ╭─────────────────────────────────────────╮   │
│ │ 👤 小明 @妈妈 💝 温馨提醒  4小时前       │   │
│ │                                        │   │
│ │ 🌧️ 明天天气提醒                        │   │
│ │ 妈妈，明天有雨记得带雨伞哦～           │   │
│ │ 天气预报显示明天降雨概率85%            │   │
│ │                                        │   │
│ │ 🎯 智能建议: 雨天适合在家做汤           │   │
│ │                                        │   │
│ │ 💖 3个赞  💬 妈妈已回复: "谢谢宝贝提醒" │   │
│ │ [💬 查看对话] [☂️ 添加天气提醒]        │   │
│ ╰─────────────────────────────────────────╯   │
│                                             │
│ ⚡ 快速发布                                  │
│ ┌─[📝文字]─[📷拍照]─[🎙️语音]─[⏰定时]─┐     │
│ │     [🔗关联功能]     [👥@成员]     │     │
│ └─────────────────────────────────────┘     │
│                                             │
├───────────────────────────────────────────────┤
│  🏠     🍽️     📦     📅     💬   ⚡        │
│ 首页    点菜    库存    日历    留言   ➕       │
└───────────────────────────────────────────────┘
```

#### 7.2 写留言界面
```
┌─────────────────────────────────┐
│  ← 写留言          [发送📤]       │
├─────────────────────────────────┤
│                                │
│ 📂 消息分类                      │
│ ┌─────────────────────────────┐ │
│ │ 💬 日常聊天 ▼                │ │
│ └─────────────────────────────┘ │
│                                │
│ ✍️ 留言内容                      │
│ ┌─────────────────────────────┐ │
│ │                             │ │
│ │ 今天买了很多新鲜蔬菜，        │ │
│ │ 大家想吃什么菜呢？           │ │
│ │                             │ │
│ │                             │ │
│ │                             │ │
│ └─────────────────────────────┘ │
│                                │
│ 🖼️ 添加内容                      │
│ [📷 拍照] [🖼️ 相册] [🎙️ 录音] [📄 文件] │
│                                │
│ 👤 @提醒成员                     │
│ □ 爸爸  ☑️ 妈妈  □ 小明  □ 全部成员 │
│                                │
│ 🔗 关联功能                      │
│ ┌─────────────────────────────┐ │
│ │ 📦 关联库存更新 ▼             │ │
│ └─────────────────────────────┘ │
│                                │
│ ⚙️ 高级选项                      │
│ □ 置顶显示  □ 紧急消息           │
│ □ 定时发送: [时间选择]           │
│                                │
│        [保存草稿]  [立即发送]     │
└─────────────────────────────────┘
```

---

## 🚀 详细开发计划

## 🚀 轻量化MVP开发计划（收敛版）

### **MVP必做功能范围**
```
✅ 核心必做:
├── 👥 家庭管理: 创建/加入家庭、成员权限
├── 📋 任务管理: 基础看板、任务分配、状态更新
├── 📦 库存管理: 多批次食材、过期提醒、基础统计
├── 🍽️ 点菜系统: 菜单创建、成员点菜、结果统计
├── 📅 日历功能: 基础事件管理、家庭共享日历
├── 💬 留言板: 文本留言、@提醒、已读状态
├── 🔔 实时通知: Socket.IO推送、事件提醒
├── 📁 文件上传: 本地直存、下载鉴权
└── 🤖 基础AI: 菜谱推荐(预算控制)、食材识别

❌ MVP可延期:
├── 🖼️ 富媒体留言: 语音、视频、定时发送
├── 🔗 第三方集成: Webhook、外部API同步
├── 📱 复杂离线: 离线写入、冲突解决
├── 🎨 高级功能: 数据分析面板、导出功能
└── ⚙️ 运维功能: 监控面板、性能优化
```

### **第一阶段：轻量化MVP (4-5周)** ⬅️ _压缩1周，聚焦核心_

#### **Sprint 1: 基础架构+认证 (1.5周)**
```
📋 开发任务清单:
├── 后端轻量化架构
│   ├── Node.js + Koa2 + TypeScript 环境
│   ├── SQLite WAL模式 + 迁移工具
│   ├── JWT双令牌认证实现
│   ├── 基础中间件 (日志、错误、CORS、限流)
│   ├── Socket.IO房间隔离配置
│   └── 本地文件存储抽象接口
├── 前端基础架构
│   ├── Vue 3 + Vite + TypeScript + Vant
│   ├── Pinia状态管理 + Vue Router
│   ├── Axios封装 + 错误处理
│   ├── Socket.IO客户端集成
│   └── 基础PWA配置(离线只读)
└── 用户+家庭功能
    ├── 用户注册/登录/刷新令牌
    ├── 家庭创建/加入/角色管理
    └── 基础权限中间件
```

#### **Sprint 2: 核心功能模块 (1.5周)**
```
📋 开发任务清单:
├── 任务管理模块
│   ├── 任务CRUD API + 状态管理
│   ├── 任务分配与看板UI
│   ├── 基础筛选与搜索
│   └── Socket.IO实时状态同步
├── 库存管理模块
│   ├── 多批次库存CRUD API
│   ├── 食材基础数据与分类
│   ├── 库存总览UI + 过期提醒
│   ├── 添加食材UI + 搜索筛选
│   └── FIFO消费逻辑
├── 文件存储模块
│   ├── 本地直存FileStorage实现
│   ├── 文件元数据表管理
│   ├── 上传API + 下载鉴权
│   └── 前端文件选择组件
└── 基础点菜模块
    ├── 菜单创建 + 菜品管理API
    ├── 订单-菜品关联表实现
    ├── 点菜UI + 统计展示
    └── Socket.IO实时同步
```

#### **Sprint 3: AI功能+日历+留言 (1.5周)**
```
📋 开发任务清单:
├── AI智能推荐
│   ├── 通义千问API集成 + 预算控制
│   ├── 基础菜谱推荐算法
│   ├── 食材图像识别(限制调用)
│   ├── AI推荐界面UI
│   └── 智能购物清单生成
├── 日历事件管理
│   ├── 日历事件CRUD API
│   ├── 事件提醒系统(Socket.IO)
│   ├── 家庭共享日历UI
│   ├── 事件参与者管理
│   └── 基础重复事件支持
├── 家庭留言板
│   ├── 留言CRUD + 分类管理
│   ├── @提醒功能 + 已读状态
│   ├── 留言板UI + 实时更新
│   └── 基础媒体文件支持
└── 通知系统完善
    ├── Socket.IO房间广播
    ├── 过期提醒定时任务
    └── 前端通知组件
```

#### **Sprint 4: 集成测试+部署优化 (0.5周)**
```
📋 开发任务清单:
├── 系统集成测试
│   ├── E2E测试: 添加库存→过期提醒→推荐菜谱→生成购物清单
│   ├── 多用户协作测试
│   ├── Socket.IO实时通信测试
│   └── 文件上传下载测试
├── 性能与安全优化
│   ├── SQLite查询优化 + 索引检查
│   ├── AI调用预算监控与熔断
│   ├── 文件上传安全检查 + 权限控制
│   └── 前端bundle优化 + 懒加载
├── 部署配置
│   ├── Docker容器化配置
│   ├── Nginx反向代理 + SSL
│   ├── SQLite备份脚本 + 目录结构
│   └── 环境变量配置模板
└── 文档与DoD
    ├── OpenAPI接口文档
    ├── 部署文档 + 运维手册
    ├── 用户使用指南
    └── MVP DoD完成验收
```

### **MVP完成定义(DoD)检查清单**
```
✅ 功能完整性:
├── 所有核心功能模块可用 (家庭/任务/库存/点菜/日历/留言)
├── 实时通知正常工作 (Socket.IO房间隔离)
├── AI功能基础可用 (预算控制下的菜谱推荐)
├── 文件上传下载鉴权正常
└── 移动端PWA离线基础功能

✅ 质量标准:
├── 主要接口响应时间 < 800ms
├── SQLite并发读写无数据不一致
├── AI调用成功率 > 90%，成本控制有效
├── Socket.IO连接稳定，消息送达率 > 95%
└── 文件上传成功率 > 98%

✅ 安全合规:
├── JWT双令牌认证机制
├── 接口级权限控制 + 家庭数据隔离
├── 文件上传白名单 + 大小限制
├── 日志脱敏 + 错误信息不泄露敏感数据
└── HTTPS + CORS正确配置

✅ 部署就绪:
├── Docker镜像构建成功
├── SQLite备份恢复机制验证
├── 监控日志结构化输出
└── 回滚方案文档化
```

---

### **第二阶段：智能化增强版本 (4-5周)**

#### **Sprint 6-7: 通知系统 + AI集成准备 (2周)**
```
📋 开发任务清单:
├── 实时通知系统
│   ├── WebSocket服务器搭建
│   ├── 前端WebSocket连接管理
│   ├── 推送通知逻辑
│   ├── 通知中心UI
│   ├── 🆕 库存过期通知
│   └── 消息持久化存储
├── 点菜统计增强
│   ├── 实时统计API
│   ├── 点菜结果展示优化
│   ├── 历史点菜记录
│   └── 数据可视化图表
├── 任务功能增强
│   ├── 任务重复设置
│   ├── 任务完成确认机制
│   ├── 任务历史记录
│   └── 完成照片功能
├── 🆕 AI集成基础
│   ├── AI API封装与配置
│   ├── 请求队列与缓存机制
│   ├── Token使用量统计
│   └── 错误重试逻辑
└── Webhook基础实现
    ├── Webhook配置管理
    ├── HTTP请求发送模块
    └── 失败重试机制
```

#### **Sprint 8-9: AI智能推荐系统 (2-3周)** ⬅️ _核心功能Sprint_
```
📋 开发任务清单:
├── 🤖 AI菜谱推荐引擎
│   ├── 📊 基于库存的菜谱匹配算法
│   ├── 🍽️ 菜品与食材关联数据建立
│   ├── 📋 食材缺失分析与购物清单生成
│   ├── 🎯 个性化推荐算法
│   ├── 📱 AI菜谱推荐界面UI
│   └── 🛒 智能购物清单功能
├── 🆕 食材AI识别
│   ├── 📷 图像识别API集成
│   ├── 🏷️ 食材名称自动识别
│   ├── ⏱️ 保质期智能预测
│   ├── 📂 分类自动判断
│   └── ✅ 识别结果确认机制
├── 智能任务解析增强
│   ├── 🗣️ 自然语言任务创建
│   ├── 📋 结构化数据提取优化
│   ├── 👤 智能执行人推荐
│   └── ⏰ 时间解析优化
├── 🆕 过期预警系统
│   ├── ⚠️ 智能过期提醒界面
│   ├── 📅 多层级提醒设置
│   ├── 🥘 过期食材菜谱推荐
│   ├── 📊 食材浪费统计分析
│   └── 💡 节约建议生成
└── 数据分析与优化
    ├── 📈 用户行为数据收集
    ├── 🎯 推荐准确率分析
    ├── ⚡ AI响应速度优化
    └── 💰 成本控制策略
```

---

### **第三阶段：系统完善与优化 (3-4周)**

#### **Sprint 10-11: 功能完善与性能优化 (2周)**
```
📋 开发任务清单:
├── 🆕 高级库存功能
│   ├── 📊 库存数据可视化分析
│   ├── 🛒 采购计划智能生成
│   ├── 📋 家庭饮食习惯分析
│   ├── 💰 食材成本统计
│   ├── 🔄 库存自动补货提醒
│   └── 📤 库存数据导出功能
├── 移动端优化
│   ├── 响应式设计调优
│   ├── 触摸交互优化 (库存管理手势)
│   ├── 加载性能优化
│   ├── 🆕 离线库存查看(PWA)
│   └── 🖼️ 图片懒加载优化
├── 数据缓存策略
│   ├── Redis缓存优化
│   ├── 🆕 SQLite查询性能优化
│   ├── 前端数据缓存
│   ├── 🖼️ 食材图片CDN缓存
│   └── API响应缓存
├── Webhook功能增强
│   ├── 🆕 库存预警消息推送
│   ├── 企业微信/钉钉适配
│   ├── 自定义消息模板
│   └── Webhook安全验证
└── 测试与修复
    ├── 单元测试编写 (包含库存模块)
    ├── 集成测试
    ├── 🆕 库存数据一致性测试
    └── Bug修复
```

#### **Sprint 12: 最终优化与部署 (1-2周)**
```
📋 开发任务清单:
├── 性能最终调优
│   ├── 🗄️ SQLite数据库优化
│   ├── 前端Bundle分析优化
│   ├── 🖼️ 食材图片压缩与CDN
│   ├── 接口响应时间优化
│   └── 内存泄漏检查
├── 用户体验最终打磨
│   ├── 动画效果优化
│   ├── 错误提示优化
│   ├── 🆕 库存操作引导功能
│   └── 加载状态改进
├── 🆕 数据安全与备份
│   ├── 🔐 SQLite数据加密
│   ├── 💾 自动备份机制
│   ├── 🔄 数据同步策略
│   └── 🛡️ 隐私保护增强
├── 监控与日志
│   ├── 系统监控面板
│   ├── 错误日志收集
│   ├── 🆕 库存操作日志
│   ├── 用户行为统计
│   └── 性能指标监控
└── 部署与运维
    ├── 生产环境部署
    ├── CI/CD管道搭建
    ├── 🆕 SQLite备份策略实施
    └── 服务监控告警
```

---

## 🤖 基于库存的AI智能推荐算法

### **核心推荐引擎架构**

```typescript
// AI菜谱推荐服务
class InventoryBasedRecommendationService {

  /**
   * 基于库存的菜谱智能推荐
   * @param familyId 家庭ID
   * @param preferences 用户偏好设置
   * @param mealContext 用餐场景 (早餐/午餐/晚餐)
   */
  async recommendRecipesByInventory(
    familyId: string,
    preferences: FamilyPreferences,
    mealContext: MealContext
  ): Promise<RecipeRecommendation[]> {

    // 1. 获取当前库存状态
    const inventory = await this.getActiveInventory(familyId);

    // 2. 分析食材紧急度
    const ingredientPriority = this.calculateIngredientPriority(inventory);

    // 3. 匹配可制作菜谱
    const availableRecipes = await this.findMatchingRecipes(inventory);

    // 4. AI增强评分
    const scoredRecipes = await this.aiEnhancedScoring(
      availableRecipes,
      ingredientPriority,
      preferences,
      mealContext
    );

    // 5. 生成推荐结果
    return this.generateRecommendations(scoredRecipes, inventory);
  }

  /**
   * 食材优先级算法 - 优先消耗即将过期的食材
   */
  private calculateIngredientPriority(inventory: InventoryItem[]): Map<string, number> {
    const priority = new Map<string, number>();

    inventory.forEach(item => {
      const daysUntilExpiry = this.getDaysUntilExpiry(item.expireDate);

      // 优先级评分算法
      let score = 10; // 基础分

      // 过期紧急度 (过期时间越近分数越高)
      if (daysUntilExpiry <= 1) score += 50;      // 明天或今天过期
      else if (daysUntilExpiry <= 3) score += 30; // 3天内过期
      else if (daysUntilExpiry <= 7) score += 10; // 一周内过期

      // 数量因子 (数量多的优先消耗)
      if (item.quantity > 2) score += 5;

      // 食材价值因子 (贵重食材优先使用)
      if (item.ingredient.category === '肉类') score += 8;
      else if (item.ingredient.category === '海鲜') score += 10;

      priority.set(item.ingredientId, score);
    });

    return priority;
  }

  /**
   * AI增强评分系统
   */
  private async aiEnhancedScoring(
    recipes: Recipe[],
    ingredientPriority: Map<string, number>,
    preferences: FamilyPreferences,
    mealContext: MealContext
  ): Promise<ScoredRecipe[]> {

    const scoredRecipes = recipes.map(recipe => {
      let score = 0;
      let availableIngredients = 0;
      let totalIngredients = recipe.ingredients.length;
      let missingIngredients: string[] = [];

      // 1. 食材匹配度评分
      recipe.ingredients.forEach(ingredient => {
        const priority = ingredientPriority.get(ingredient.ingredientId) || 0;
        if (priority > 0) {
          score += priority;
          availableIngredients++;
        } else {
          missingIngredients.push(ingredient.name);
        }
      });

      // 2. 完整度评分 (能用现有食材做出来的菜优先)
      const completeness = availableIngredients / totalIngredients;
      score += completeness * 30;

      // 3. 难度评分 (简单的菜优先)
      score += (6 - recipe.difficultyLevel) * 5;

      // 4. 时间评分 (快手菜优先)
      if (recipe.cookingTime <= 15) score += 10;
      else if (recipe.cookingTime <= 30) score += 5;

      // 5. 场景适配评分
      if (this.isRecipeSuitableForMealContext(recipe, mealContext)) {
        score += 15;
      }

      // 6. 家庭偏好评分
      score += this.calculatePreferenceScore(recipe, preferences);

      return {
        recipe,
        score,
        completeness,
        availableIngredients,
        missingIngredients,
        estimatedCost: this.calculateMissingIngredientsCost(missingIngredients)
      };
    });

    // AI进一步优化评分
    return await this.callAIForScoreOptimization(scoredRecipes, mealContext);
  }

  /**
   * 智能购物清单生成
   */
  async generateSmartShoppingList(
    selectedRecipes: Recipe[],
    currentInventory: InventoryItem[]
  ): Promise<ShoppingList> {

    const neededIngredients = new Map<string, ShoppingItem>();

    // 收集所有需要的食材
    selectedRecipes.forEach(recipe => {
      recipe.ingredients.forEach(ingredient => {
        const currentStock = currentInventory.find(
          item => item.ingredientId === ingredient.ingredientId
        );

        const needed = ingredient.quantity - (currentStock?.quantity || 0);

        if (needed > 0) {
          if (neededIngredients.has(ingredient.ingredientId)) {
            const existing = neededIngredients.get(ingredient.ingredientId)!;
            existing.quantity += needed;
          } else {
            neededIngredients.set(ingredient.ingredientId, {
              ingredientId: ingredient.ingredientId,
              name: ingredient.name,
              quantity: needed,
              unit: ingredient.unit,
              estimatedPrice: await this.getEstimatedPrice(ingredient.ingredientId),
              priority: this.getShoppingPriority(ingredient),
              category: ingredient.category
            });
          }
        }
      });
    });

    // AI优化购物清单
    const optimizedList = await this.aiOptimizeShoppingList(
      Array.from(neededIngredients.values())
    );

    return {
      items: optimizedList,
      totalEstimatedCost: optimizedList.reduce((sum, item) => sum + item.estimatedPrice * item.quantity, 0),
      generatedAt: new Date(),
      suggestedStores: await this.suggestNearbyStores(optimizedList)
    };
  }
}
```

### **算法特色功能**

#### **1. 智能过期食材消耗**
- **紧急度评分**: 根据过期时间自动调整推荐优先级
- **创意用法**: AI生成避免浪费的创意料理方法
- **保存建议**: 智能推荐食材保存和延期技巧

#### **2. 季节性智能推荐**
- **时令适配**: 根据季节推荐应季菜品
- **营养搭配**: AI分析营养成分，确保搭配合理
- **地域特色**: 结合地理位置推荐本地特色菜

#### **3. 成本优化算法**
- **价格预测**: 根据市场价格智能推荐性价比高的菜品
- **替代建议**: 自动推荐价格更低的替代食材
- **批量采购**: 优化购物清单，建议批量购买节省成本

---

## 📊 项目资源估算

### **团队配置建议**
```
推荐团队规模: 3-4人 (增加库存功能后)
├── 全栈工程师 × 2 (前后端开发、AI集成)
├── UI/UX设计师 × 1 (界面设计、用户体验优化)
└── 产品经理 × 1 (需求管理、项目协调、测试)
```

### **成本预估（更新版）**

| 类别 | 月成本 | 说明 |
|------|--------|------|
| 服务器 | ¥200-500 | 云服务器(SQLite本地存储) |
| AI API | ¥300-800 | 通义千问调用费用(增加图像识别) |
| 域名SSL | ¥100 | 域名和证书 |
| 第三方服务 | ¥300 | 短信、OSS、图像识别API |
| **总计** | **¥900-1700/月** | 根据用户量和AI使用量弹性调整 |

### **开发时间估算**

| 阶段 | 时间 | 主要交付物 |
|------|------|-----------|
| 第一阶段 | 5-6周 | MVP版本(含基础库存) |
| 第二阶段 | 4-5周 | AI智能推荐系统 |
| 第三阶段 | 3-4周 | 性能优化和部署 |
| **总计** | **12-15周** | **完整产品上线** |

---

## ⚠️ 风险评估与应对策略

### **新增风险（库存功能相关）**

| 风险类型 | 风险描述 | 影响程度 | 应对措施 |
|---------|---------|---------|---------|
| **数据一致性** | SQLite并发写入可能导致库存数据不一致 | 中 | 实施数据库事务，添加乐观锁机制 |
| **AI成本超预算** | 图像识别和菜谱推荐API调用量过大 | 中-高 | 实施智能缓存，设置月度预算告警 |
| **用户接受度** | 库存管理功能用户觉得太复杂 | 中 | 实施渐进式功能引导，简化操作流程 |
| **性能瓶颈** | SQLite在高并发场景下性能问题 | 低-中 | 读写分离，关键查询添加索引优化 |

### **通用风险应对**

| 风险 | 影响 | 应对措施 |
|------|------|----------|
| AI服务不稳定 | 高 | 多供应商备份，本地缓存，降级策略 |
| 技术难度超预期 | 中 | 分阶段实施，MVP优先，复杂功能后期迭代 |
| 竞争对手出现 | 中 | 专注差异化功能，用户体验为王 |
| 团队协作问题 | 中 | 建立明确的开发规范，定期code review |

---

## 🎯 关键成功因素

### **产品层面**
1. **🎯 用户价值导向**: 真正解决家庭管理痛点，而非功能堆砌
2. **📱 移动优先体验**: 界面简洁直观，操作流程顺畅自然
3. **🤖 AI实用性**: AI功能必须产生实际价值，避免为了AI而AI
4. **📊 数据驱动**: 基于用户行为数据持续优化产品功能

### **技术层面**
1. **⚡ 性能优先**: SQLite查询优化，前端懒加载，接口响应<1秒
2. **🔒 数据安全**: 家庭隐私数据加密，备份策略完善
3. **🔧 可维护性**: 代码规范统一，文档齐全，便于后续迭代
4. **📈 可扩展性**: 架构设计考虑未来功能扩展，避免重构风险

### **运营层面**
1. **👥 种子用户**: 找到真实的家庭用户进行深度测试
2. **🔄 快速迭代**: 2周一个版本，快速响应用户反馈
3. **💰 成本控制**: AI调用成本监控，防止意外超支
4. **📣 口碑传播**: 专注用户体验，依靠用户推荐增长

---

## 🚀 授人以渔：学习成长建议

### **技能提升路径**

#### **前端开发方向**
- **Vue 3生态深入**: 组合式API、Pinia状态管理、Vite构建优化
- **移动端专精**: PWA开发、触摸手势、响应式设计最佳实践
- **性能优化**: Bundle分析、懒加载、虚拟滚动等高级技巧

#### **后端架构方向**
- **Node.js进阶**: 异步编程模式、内存管理、性能调优
- **SQLite优化**: 索引策略、查询优化、并发控制
- **微服务架构**: 服务拆分、API设计、容器化部署

#### **AI集成方向**
- **大模型应用**: Prompt工程、结构化输出、成本控制
- **图像识别**: OCR技术、食材识别算法、模型优化
- **推荐系统**: 协同过滤、内容推荐、实时计算

### **扩展思考方向**

#### **商业模式创新**
- **订阅服务**: 高级AI功能、更多云存储、家庭数据分析
- **电商导购**: 基于购物清单的食材电商合作分成
- **内容生态**: 用户分享优秀菜谱，建立社区内容平台

#### **技术架构演进**
- **多端同步**: 如何实现Web、iOS、Android数据实时同步？
- **离线能力**: PWA离线模式下的数据一致性如何保证？
- **智能硬件**: 如何接入智能冰箱、电子秤等IoT设备？

#### **用户场景拓展**
- **企业场景**: 办公室茶水间管理、员工餐厅点餐
- **社区服务**: 邻里互助、食材共享、团购组织
- **养老服务**: 老人饮食健康管理、营养监控

### **实际项目经验积累**

#### **开发最佳实践**
1. **版本管理**: Git flow规范，代码review机制
2. **测试策略**: 单元测试、集成测试、端到端测试
3. **监控体系**: 错误日志、性能监控、用户行为分析
4. **安全防护**: SQL注入防护、XSS防护、CSRF防护

#### **用户体验设计**
1. **用户调研**: 深入理解真实用户需求，避免主观臆断
2. **A/B测试**: 数据驱动的功能优化决策
3. **无障碍设计**: 考虑老年人、视障用户的使用体验
4. **国际化支持**: 多语言、多文化适配的技术实现

---

## 📝 总结

这份增强版开发计划在原有功能基础上，新增了**智能库存管理系统**，将"家和"助手从简单的任务分配工具升级为**全方位的家庭生活管理平台**。

### **核心价值提升**
- **减少食材浪费**: 过期提醒 + AI菜谱推荐
- **简化购物决策**: 智能购物清单生成
- **提升烹饪效率**: 基于库存的菜谱匹配
- **优化家庭开支**: 食材成本统计分析

### **技术方案亮点**
- **轻量级数据库**: SQLite简化部署，适合中小型应用
- **AI深度集成**: 图像识别 + 自然语言处理 + 智能推荐
- **移动优先设计**: PWA技术，接近原生应用体验
- **成本控制策略**: 智能缓存减少AI调用，预算监控

### **开发建议**
1. **MVP优先**: 先实现基础功能验证产品价值
2. **用户反馈驱动**: 基于真实用户使用情况持续迭代
3. **技术债务控制**: 保持代码质量，避免后期重构成本
4. **团队能力匹配**: 根据团队技术栈选择最适合的实施方案

这个产品有潜力成为家庭生活的**数字化管家**，关键在于执行过程中保持对用户价值的专注，以及对技术实现的务实态度。

**记住**: 好的产品不在于功能有多复杂，而在于能多好地解决用户的真实问题。🏠✨

---

## 🎨 设计指导原则与最佳实践

### **家庭产品设计的核心原则（基于FamilyWall经验）**

#### **1. 简约至上原则**
```
设计减法思维:
├── 📱 界面极简化 - 每屏最多3-5个核心元素
├── 🎯 功能聚焦化 - 优先家庭核心需求
├── 🔤 文案精简化 - 用最少文字表达最多信息
└── 🖱️ 操作简单化 - 3步内完成主要任务
```

#### **2. 情感化设计原则**
```
温暖家庭体验:
├── 🎨 温馨配色 - 避免过于商务化的冷色调
├── 🔄 圆润设计 - 多用圆角、曲线营造亲和感
├── 😊 友好图标 - 情感化表达替代纯功能图标
├── 💕 互动反馈 - 点赞、拥抱等情感化交互
└── 🏠 生活场景 - 贴近真实家庭使用场景设计
```

#### **3. 代际友好原则**
```
老少皆宜设计:
├── 👆 大按钮设计 - 最小点击区域44px×44px
├── 🔤 清晰字体 - 主要内容至少16px字号
├── 🎨 高对比度 - 文字与背景对比度≥4.5:1
├── 🔍 简化导航 - 扁平化信息架构
├── 💡 操作引导 - 新手引导和操作提示
└── 🗣️ 语音支持 - 语音输入和播报功能
```

#### **4. 智能化渐进原则**
```
AI功能设计策略:
├── 🤖 AI辅助为主 - 不完全替代人的决策
├── 🎯 情境感知 - 基于家庭生活规律智能推荐
├── 📚 学习能力 - 从用户行为中持续优化
├── 🔧 可控可调 - 用户可自定义AI推荐程度
└── 🚫 优雅降级 - AI失效时不影响核心功能
```

### **组件化设计最佳实践**

#### **卡片组件设计规范**
```
卡片设计检查清单:
├── 📏 统一尺寸 - 基于8px网格系统
├── 🎨 圆角规范 - 8px圆角营造亲和感
├── 🌟 阴影规范 - 浅阴影增加层次感
├── 📱 响应式适配 - 不同屏幕下自适应
├── 🔄 状态设计 - 默认/悬停/选中/禁用状态
├── ⚡ 加载状态 - 骨架屏或加载指示器
└── 📊 数据展示 - 重要信息突出显示
```

#### **表单设计最佳实践**
```
用户友好表单:
├── 📝 标签清晰 - 简洁明了的字段说明
├── 🎯 聚焦设计 - 明显的输入框焦点状态
├── ✅ 实时验证 - 输入时即时反馈验证结果
├── 🚨 错误提示 - 友好的错误信息和修改建议
├── 💡 帮助文本 - 必要时提供输入格式示例
├── 📱 移动优化 - 合适的键盘类型和输入方式
└── 🔄 自动保存 - 防止数据意外丢失
```

### **交互体验优化策略**

#### **页面加载优化**
```
性能体验优化:
├── ⚡ 骨架屏设计 - 内容加载前的占位展示
├── 🖼️ 图片懒加载 - 可视区域内才加载图片
├── 📦 分页加载 - 长列表采用分页或虚拟滚动
├── 💾 智能缓存 - 常用数据本地缓存策略
├── 🔄 离线支持 - PWA离线能力设计
└── 📊 加载指示 - 清晰的进度反馈
```

#### **错误状态设计**
```
友好错误处理:
├── 😊 友好提示 - 用温和语言描述错误
├── 🎯 明确指导 - 提供具体的解决步骤
├── 🔄 重试机制 - 简单的错误重试选项
├── 📱 联系支持 - 复杂错误提供帮助渠道
├── 🎨 视觉缓解 - 用插图减轻用户挫折感
└── 📊 错误分类 - 网络/权限/数据等分类处理
```

### **家庭应用特有设计考量**

#### **隐私保护设计**
```
家庭隐私考虑:
├── 🔒 分级权限 - 不同家庭成员不同访问权限
├── 👁️ 可见性控制 - 个人/家庭/公开信息分级
├── 🔐 数据加密 - 敏感信息端到端加密
├── 🕐 自动清理 - 过期数据自动删除机制
└── ⚙️ 隐私设置 - 清晰的隐私控制选项
```

#### **多人协作体验**
```
家庭协作优化:
├── 👥 在线状态 - 显示家庭成员在线情况
├── 🔔 智能提醒 - 基于重要性和紧急度的提醒策略
├── 📱 冲突处理 - 多人同时编辑的冲突解决
├── 📊 权限可视 - 清晰显示谁能做什么操作
├── 🎭 角色定制 - 灵活的家庭角色和权限设置
└── 📈 协作统计 - 家庭成员参与度统计
```

### **技术实现建议**

#### **响应式设计策略**
```
多设备适配:
├── 📱 移动优先 - Mobile First设计原则
├── 🖥️ 桌面增强 - 大屏幕下的功能扩展
├── 📟 平板优化 - 中等屏幕的特殊布局考虑
├── 🖱️ 输入适配 - 触摸/鼠标/键盘多种输入
├── 📐 弹性布局 - CSS Grid和Flexbox结合使用
└── 🔍 媒体查询 - 合理的断点设置
```

#### **无障碍设计（A11Y）**
```
包容性设计:
├── 🔤 语义化HTML - 正确使用HTML标签
├── 📱 屏幕朗读支持 - 完善的aria标签
├── ⌨️ 键盘导航 - 完整的键盘操作支持
├── 🎨 颜色辅助 - 不依赖颜色传达重要信息
├── 📏 缩放支持 - 200%缩放下仍可正常使用
└── 🔊 多感官反馈 - 视觉+听觉+触觉反馈结合
```

---

## 🎯 总结与展望

### **设计价值总结**

通过参考FamilyWall的成功经验，结合2024年最新的UX/UI设计趋势，我们为"家和"智能助手制定了全面的设计体系：

#### **设计升级亮点**
- **🏠 温馨家庭风格**: 摒弃冷冰冰的工具感，营造温暖的家庭氛围
- **📱 极简交互体验**: 5个主导航+智能悬浮按钮，减少认知负担
- **🤖 AI深度融合**: 智能推荐不突兀，自然融入日常使用流程
- **👥 代际友好设计**: 大按钮+清晰字体+直观图标，老少皆宜

#### **核心竞争优势**
1. **情感化连接**: 不只是工具，更是增进家庭情感的桥梁
2. **智能化程度**: 基于库存的AI菜谱推荐，解决实际生活痛点
3. **一体化体验**: 库存+菜谱+日历+留言完整闭环
4. **简约而强大**: 界面简洁但功能丰富，学习成本低

### **实施建议**

#### **分阶段设计实施**
```
🎨 设计开发节奏:
├── Phase 1: 建立设计系统和组件库（2周）
├── Phase 2: 完成5个主要页面设计稿（3周）
├── Phase 3: 交互原型制作和用户测试（2周）
├── Phase 4: 视觉优化和前端组件开发（4周）
└── Phase 5: 细节打磨和多设备适配（2周）
```

#### **用户测试策略**
- **👨‍👩‍👧‍👦 家庭用户测试**: 找3-5个真实家庭进行深度使用测试
- **👵 老年用户专项**: 特别关注50岁以上用户的使用体验
- **📱 多设备测试**: 确保iPhone/Android/iPad/桌面端体验一致
- **⚡ 性能测试**: 在低端设备上的流畅性测试

这套设计体系将帮助"家和"智能助手真正成为每个家庭不可或缺的数字化管家，通过温暖而智能的设计，让家庭生活更加和谐美好。

---

## 🔒 轻量化安全与运维方案

### **安全框架（MVP级别）**

#### **1. 身份认证与授权**
```typescript
// JWT双令牌机制
const AUTH_CONFIG = {
  accessToken: {
    secret: process.env.JWT_ACCESS_SECRET,
    expiresIn: '15m'  // 短期访问令牌
  },
  refreshToken: {
    secret: process.env.JWT_REFRESH_SECRET,
    expiresIn: '7d'   // 长期刷新令牌
  }
}

// 家庭级别RBAC
const FAMILY_ROLES = {
  owner: ['*'],  // 所有权限
  admin: ['read', 'write', 'invite'],
  member: ['read', 'write']
}
```

#### **2. 接口安全控制**
```javascript
// 内存令牌桶限流（单实例有效）
const RATE_LIMITS = {
  '/api/auth/login': { windowMs: 15 * 60 * 1000, max: 5 },   // 登录
  '/api/ai/*': { windowMs: 60 * 1000, max: 10 },            // AI调用
  '/api/files/upload': { windowMs: 60 * 1000, max: 20 },    // 文件上传
  '/api/*': { windowMs: 60 * 1000, max: 100 }               // 通用接口
}

// 文件上传安全检查
const FILE_SECURITY = {
  maxSize: 10 * 1024 * 1024,  // 10MB
  allowedMimes: ['image/png', 'image/jpeg', 'image/webp', 'audio/mpeg', 'application/pdf'],
  allowedExtensions: ['.png', '.jpg', '.jpeg', '.webp', '.mp3', '.pdf'],
  virusScan: false,  // MVP阶段暂不集成
  contentValidation: true  // 验证文件头匹配MIME类型
}
```

#### **3. 数据保护策略**
```sql
-- 数据库级别安全
PRAGMA journal_mode=WAL;
PRAGMA foreign_keys=ON;
PRAGMA secure_delete=ON;  -- 确保删除数据不可恢复

-- 敏感数据字段设计
CREATE TABLE users (
    phone TEXT NOT NULL,  -- 手机号需要脱敏显示
    -- 不存储明文密码，仅存储手机号+验证码登录
    last_login_ip TEXT,   -- IP需要脱敏记录
    -- ...
);
```

#### **4. 日志安全与监控**
```javascript
// 结构化日志配置（使用pino）
const LOGGER_CONFIG = {
  level: process.env.LOG_LEVEL || 'info',
  redact: {
    paths: ['req.headers.authorization', 'req.body.password', 'phone', 'req.ip'],
    censor: '***REDACTED***'
  },
  formatters: {
    level: (label) => ({ level: label }),
    bindings: (bindings) => ({ pid: bindings.pid, hostname: bindings.hostname })
  }
}

// 关键操作审计日志
const AUDIT_EVENTS = [
  'USER_LOGIN', 'USER_LOGOUT', 'FAMILY_JOIN', 'FAMILY_LEAVE',
  'SENSITIVE_DATA_ACCESS', 'ADMIN_OPERATION', 'FILE_UPLOAD', 'AI_CALL'
]
```

### **运维配置（轻量化版本）**

#### **1. 容器化部署**
```dockerfile
# Dockerfile优化版本
FROM node:18-alpine
WORKDIR /app

# 非root用户运行
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nodejs -u 1001

# 复制依赖文件
COPY package*.json ./
RUN npm ci --only=production && npm cache clean --force

# 复制应用代码
COPY --chown=nodejs:nodejs . .

# 创建必要目录
RUN mkdir -p storage/avatars storage/ingredients storage/messages backups
RUN chown -R nodejs:nodejs storage backups

USER nodejs
EXPOSE 3000

# 健康检查
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD node healthcheck.js

CMD ["node", "dist/index.js"]
```

#### **2. Nginx配置优化**
```nginx
# nginx.conf - 轻量化生产配置
server {
    listen 80;
    server_name yourdomain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name yourdomain.com;

    ssl_certificate /etc/ssl/certs/yourdomain.com.crt;
    ssl_certificate_key /etc/ssl/private/yourdomain.com.key;
    ssl_protocols TLSv1.2 TLSv1.3;

    # 文件上传大小限制
    client_max_body_size 10M;

    # Socket.IO支持
    location /socket.io/ {
        proxy_pass http://app:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # API代理
    location /api/ {
        proxy_pass http://app:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 静态文件
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }
}
```

#### **3. SQLite备份与恢复策略**
```bash
#!/bin/bash
# backup.sh - SQLite备份脚本

DB_PATH="/app/data/database.db"
BACKUP_DIR="/app/backups"
DATE=$(date +%Y%m%d-%H%M%S)
BACKUP_FILE="$BACKUP_DIR/backup-$DATE.db"

# 创建备份目录
mkdir -p $BACKUP_DIR

# 在线备份（使用VACUUM INTO避免锁定）
sqlite3 $DB_PATH "VACUUM INTO '$BACKUP_FILE'"

# 验证备份完整性
if sqlite3 $BACKUP_FILE "PRAGMA integrity_check;" | grep -q "ok"; then
    echo "✅ 备份成功: $BACKUP_FILE"

    # 保留最近7天的备份
    find $BACKUP_DIR -name "backup-*.db" -mtime +7 -delete
else
    echo "❌ 备份失败: $BACKUP_FILE"
    rm -f $BACKUP_FILE
    exit 1
fi

# 文件目录同步备份
rsync -av --delete /app/storage/ /app/backups/storage-$DATE/
```

#### **4. 监控与告警（基础版）**
```javascript
// 基础监控指标收集
const MONITORING = {
  healthCheck: {
    endpoint: '/health',
    checks: ['database', 'storage', 'ai-service']
  },

  metrics: {
    // 使用简单的内存计数器
    requestCount: new Map(),
    errorCount: new Map(),
    aiCallCount: 0,
    aiCostToday: 0,

    // 定时重置计数器
    resetInterval: 24 * 60 * 60 * 1000  // 24小时
  },

  alerts: {
    aiDailyBudgetLimit: 200,     // 日预算200元
    errorRateThreshold: 0.05,    // 错误率>5%告警
    diskSpaceThreshold: 0.9      // 磁盘使用率>90%告警
  }
}

// 健康检查端点
app.get('/health', async (ctx) => {
  const checks = {
    database: await checkDatabase(),
    storage: await checkStorage(),
    aiService: await checkAIService(),
    memory: process.memoryUsage(),
    uptime: process.uptime()
  }

  const isHealthy = Object.values(checks).every(check =>
    typeof check === 'object' ? check.status === 'ok' : check
  )

  ctx.status = isHealthy ? 200 : 503
  ctx.body = { status: isHealthy ? 'ok' : 'error', checks }
})
```

#### **5. 环境变量配置模板**
```bash
# .env.example - 轻量化配置模板

# 应用配置
NODE_ENV=production
PORT=3000
LOG_LEVEL=info

# JWT密钥（生产环境必须更换）
JWT_ACCESS_SECRET=your-super-secret-access-key-change-me
JWT_REFRESH_SECRET=your-super-secret-refresh-key-change-me

# SQLite配置
DATABASE_PATH=/app/data/database.db
DATABASE_BACKUP_INTERVAL=6h

# 文件存储
FILE_DRIVER=local
STORAGE_PATH=/app/storage
UPLOAD_MAX_SIZE=10485760
UPLOAD_ALLOWED_TYPES=image/png,image/jpeg,image/webp,audio/mpeg,application/pdf

# AI配置
AI_PROVIDER=tongyi
AI_API_KEY=your-ai-api-key
AI_DAILY_BUDGET=200
AI_DAILY_CALL_LIMIT=1000
AI_IMAGE_RECOGNITION=true

# 安全配置
CORS_ORIGINS=https://yourdomain.com
RATE_LIMIT_ENABLED=true
SESSION_SECRET=your-session-secret

# 监控告警
HEALTH_CHECK_INTERVAL=30s
ALERT_EMAIL=admin@yourdomain.com
ALERT_WEBHOOK_URL=https://hooks.slack.com/your-webhook
```

### **迁移扩展路径**

```
轻量化阶段 → 生产级扩展:

🔒 安全升级:
├── 内存限流 → Redis分布式限流
├── 本地日志 → 中心化日志系统(ELK)
├── 基础监控 → Prometheus + Grafana
├── 手动备份 → 自动化备份+异地存储
└── 基础告警 → 完整告警体系

🚀 性能扩展:
├── 单实例 → 负载均衡多实例
├── Socket.IO单机 → Redis适配器
├── 本地缓存 → Redis集群
├── SQLite → PostgreSQL主从
└── 本地文件 → 对象存储CDN

🛠️ 运维升级:
├── Docker单容器 → Kubernetes编排
├── 手动部署 → CI/CD自动化
├── 基础监控 → APM性能监控
├── 日志文件 → 结构化日志平台
└── 手动扩容 → 自动伸缩
```

**记住**: 轻量化不是简陋化，而是在保证核心功能完整的前提下，选择最简单、最可靠的技术方案，快速验证产品价值。🏠✨

---

*文档版本: 3.0*
*最后更新: 2025年9月26日*
*新增内容: 轻量化技术栈、数据库优化、MVP范围收敛、安全运维方案*
*参考文档: 家和智能助手-评审与轻量化建议.md*
*总页数: [自动生成]*